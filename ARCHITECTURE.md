# ะััะธัะตะบัััะฐ ะฟัะพะตะบัะฐ LSI Calculator

## ๐ ะะฑะทะพั ะฟัะพะตะบัะฐ

ะญัะพ Flutter ะฟัะธะปะพะถะตะฝะธะต ะดะปั ัะฐััะตัะฐ ะธะฝะดะตะบัะฐ ะฝะฐัััะตะฝะธั ะะฐะฝะถะตะปัะต (LSI) ะฒะพะดั ะฒ ะฑะฐััะตะนะฝะฐั. ะัะธะปะพะถะตะฝะธะต ะธัะฟะพะปัะทัะตั MVVM ะฐััะธัะตะบัััั ั Riverpod ะดะปั ัะฟัะฐะฒะปะตะฝะธั ัะพััะพัะฝะธะตะผ ะธ ะธะฝัะตะณัะธััะตััั ั Orenda Web API.

---

## ๐๏ธ ะััะธัะตะบัััะฐ (MVVM)

ะัะพะตะบั ัะปะตะดัะตั ะฟะฐััะตัะฝั **Model-View-ViewModel (MVVM)**:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    VIEW (UI Layer)                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  LSICalculatorScreen                             โ   โ
โ  โ  - ะัะพะฑัะฐะถะฐะตั ัะพัะผั ะฒะฒะพะดะฐ ะฟะฐัะฐะผะตััะพะฒ             โ   โ
โ  โ  - ะะพะบะฐะทัะฒะฐะตั ัะตะทัะปััะฐัั ัะฐััะตัะฐ                 โ   โ
โ  โ  - ะัะฟะพะปัะทัะตั ConsumerWidget ะดะปั ะฟะพะดะฟะธัะบะธ        โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                          โ                               โ
โ                          โ ref.watch() / ref.read()      โ
โ                          โผ                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   VIEWMODEL (State)                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  LSIFormNotifier / LSIResultNotifier             โ   โ
โ  โ  - ะฃะฟัะฐะฒะปัะตั ัะพัะผะพะน ะธ ะฒะฐะปะธะดะฐัะธะตะน                 โ   โ
โ  โ  - ะะฑัะฐะฑะฐััะฒะฐะตั ะฑะธะทะฝะตั-ะปะพะณะธะบั                    โ   โ
โ  โ  - ะะฑะฝะพะฒะปัะตั ัะพััะพัะฝะธะต ัะตัะตะท StateNotifier       โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                          โ                               โ
โ                          โ ะฒัะทัะฒะฐะตั ะผะตัะพะดั              โ
โ                          โผ                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    MODEL & SERVICES                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  Models (Data Classes)   โ  โ  Services (API)      โ โ
โ  โ  - LSIParameters         โ  โ  - LSIApiService     โ โ
โ  โ  - LSIResult             โ  โ  - TokenStorageServiceโ โ
โ  โ  - ColorsResponse        โ  โโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะปััะตะฒัะต ะฟัะธะฝัะธะฟั:

- **View**: ะขะพะปัะบะพ ะพัะพะฑัะฐะถะตะฝะธะต UI, ะฝะต ัะพะดะตัะถะธั ะฑะธะทะฝะตั-ะปะพะณะธะบะธ
- **ViewModel**: ะฃะฟัะฐะฒะปัะตั ัะพััะพัะฝะธะตะผ ะธ ะฒะฐะปะธะดะฐัะธะตะน, ะฒัะทัะฒะฐะตั ัะตัะฒะธัั
- **Model**: ะงะธัััะต data-ะบะปะฐััั ะฑะตะท ะปะพะณะธะบะธ
- **Services**: ะัะฒะตัะฐัั ะทะฐ ะฒะทะฐะธะผะพะดะตะนััะฒะธะต ั API ะธ ััะฐะฝะธะปะธัะตะผ

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
lib/
โโโ constants/
โ   โโโ api_constants.dart          # ะะพะฝััะฐะฝัั API (URL, endpoints, ัะพะบะตะฝ)
โ
โโโ models/
โ   โโโ lsi_parameters.dart          # ะะพะดะตะปั ะฒัะพะดะฝัั ะฟะฐัะฐะผะตััะพะฒ ัะฐััะตัะฐ
โ   โโโ lsi_result.dart             # ะะพะดะตะปั ัะตะทัะปััะฐัะฐ ัะฐััะตัะฐ
โ   โโโ colors_response.dart        # ะะพะดะตะปั ะพัะฒะตัะฐ API ะดะปั ัะฒะตัะพะฒัั ะธะฝะดะธะบะฐัะพัะพะฒ
โ
โโโ services/
โ   โโโ lsi_api_service.dart         # ะกะตัะฒะธั ะดะปั ัะฐะฑะพัั ั Orenda API
โ   โโโ token_storage_service.dart   # ะกะตัะฒะธั ะดะปั ะฑะตะทะพะฟะฐัะฝะพะณะพ ััะฐะฝะตะฝะธั ัะพะบะตะฝะพะฒ
โ
โโโ viewmodels/
โ   โโโ lsi_calculator_viewmodel.dart # ViewModels: ัะฟัะฐะฒะปะตะฝะธะต ัะพัะผะพะน ะธ ัะตะทัะปััะฐัะฐะผะธ
โ
โโโ views/
โ   โโโ lsi_calculator_screen.dart    # ะะปะฐะฒะฝัะน ัะบัะฐะฝ ะฟัะธะปะพะถะตะฝะธั
โ
โโโ widgets/
โ   โโโ input_field.dart             # ะะตัะตะธัะฟะพะปัะทัะตะผัะน ะฒะธะดะถะตั ะดะปั ะฒะฒะพะดะฐ ัะธัะตะป
โ   โโโ lsi_result_card.dart         # ะะธะดะถะตั ะดะปั ะพัะพะฑัะฐะถะตะฝะธั ัะตะทัะปััะฐัะพะฒ
โ
โโโ main.dart                        # ะขะพัะบะฐ ะฒัะพะดะฐ ะฒ ะฟัะธะปะพะถะตะฝะธะต
```

---

## ๐ ะะตัะฐะปัะฝัะน ัะฐะทะฑะพั ะบะพะผะฟะพะฝะตะฝัะพะฒ

### 1. **Constants** (`api_constants.dart`)

```dart
class ApiConstants {
  static const String baseUrl = 'https://orendatechapi.com';
  static const String calculateLSIEndpoint = '/calculateLSI';
  static const String colorsEndpoint = '/colors';
  static const String apiToken = '...'; // ะะปะธะฝะฝัะน ัะพะบะตะฝ ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ
}
```

**ะะฐะทะฝะฐัะตะฝะธะต**: ะฆะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะพะต ััะฐะฝะตะฝะธะต ะฒัะตั ะบะพะฝััะฐะฝั API. ะัะปะธ API ะธะทะผะตะฝะธััั, ะฟัะฐะฒะธัั ะฝัะถะฝะพ ัะพะปัะบะพ ะทะดะตัั.

**ะะพัะตะผั ัะฐะบ**: DRY (Don't Repeat Yourself) - ะพะดะธะฝ ะธััะพัะฝะธะบ ะฟัะฐะฒะดั ะดะปั URL ะธ ัะพะบะตะฝะพะฒ.

---

### 2. **Models** (ะะพะดะตะปะธ ะดะฐะฝะฝัั)

#### `LSIParameters`

ะกะพะดะตัะถะธั ะฒัะต 14 ะฟะฐัะฐะผะตััะพะฒ ะดะปั ัะฐััะตัะฐ:

- ะขะตะบััะธะต ะฟะฐัะฐะผะตััั (7): ัะตะผะฟะตัะฐัััะฐ, pH, ัะตะปะพัะฝะพััั, ะบะฐะปััะธะน, CYA, ัะพะปั, ะฑะพัะฐัั
- ะะตะปะฐะตะผัะต ะฟะฐัะฐะผะตััั (7): ัะต ะถะต ัะฐะผัะต

**ะัะพะฑะตะฝะฝะพััะธ**:

- ะัะฟะพะปัะทัะตั `@JsonSerializable` ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ัะตัะธะฐะปะธะทะฐัะธะธ
- ะะตัะพะด `copyWith()` ะดะปั immutable ะพะฑะฝะพะฒะปะตะฝะธะน
- ะัะต ะฟะพะปั `final` - ะฝะตะธะทะผะตะฝัะตะผะพััั ะพะฑะตัะฟะตัะธะฒะฐะตั ะฑะตะทะพะฟะฐัะฝะพััั

#### `LSIResult`

ะะตะทัะปััะฐั ัะฐััะตัะฐ ะธะท API:

```dart
class LSIResult {
  final double current;        // ะขะตะบััะธะน LSI
  final double desired;        // ะะตะปะฐะตะผัะน LSI
  final double? phCeilingCurrent;   // ะะฟัะธะพะฝะฐะปัะฝะพ
  final double? phCeilingDesired;  // ะะฟัะธะพะฝะฐะปัะฝะพ
}
```

**ะะฐะถะฝัะน ะผะพะผะตะฝั**: ะัะฟะพะปัะทัะตั ะบะฐััะพะผะฝัะน `_parseDouble()` ะดะปั ะพะฑัะฐะฑะพัะบะธ ัะปััะฐะตะฒ, ะบะพะณะดะฐ API ะฒะพะทะฒัะฐัะฐะตั ัััะพะบะธ ะฒะผะตััะพ ัะธัะตะป (ะทะฐัะธัะฐ ะพั ะฝะตััะฐะฑะธะปัะฝะพััะธ API).

#### `ColorsResponse`

ะกะพะดะตัะถะธั HEX-ะบะพะดั ัะฒะตัะพะฒ ะดะปั ะฒะธะทัะฐะปัะฝะพะน ะธะฝะดะธะบะฐัะธะธ ะบะฐะถะดะพะณะพ ะฟะฐัะฐะผะตััะฐ.

---

### 3. **Services** (ะกะตัะฒะธัั)

#### `TokenStorageService`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะะตะทะพะฟะฐัะฝะพะต ััะฐะฝะตะฝะธะต API ัะพะบะตะฝะพะฒ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ `flutter_secure_storage`.

**ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ**:

- ะะฐ iOS ะธัะฟะพะปัะทัะตั Keychain (ัะธััะตะผะฝะพะต ะฑะตะทะพะฟะฐัะฝะพะต ััะฐะฝะธะปะธัะต)
- ะะฐ Android ะธัะฟะพะปัะทัะตั EncryptedSharedPreferences
- ะกะพััะฐะฝัะตั ะฒัะตะผั ะธััะตัะตะฝะธั ัะพะบะตะฝะฐ (24 ัะฐัะฐ)
- ะะตัะพะด `initializeDefaultToken()` ัะพััะฐะฝัะตั ะดะตัะพะปัะฝัะน ัะพะบะตะฝ ะฟัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต

**ะะพัะตะผั ะฒะฐะถะฝะพ**: ะขะพะบะตะฝั ะฝะต ะดะพะปะถะฝั ััะฐะฝะธัััั ะฒ ะพัะบัััะพะผ ะฒะธะดะต. Secure Storage ัะธัััะตั ะดะฐะฝะฝัะต.

#### `LSIApiService`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะัั ะปะพะณะธะบะฐ ัะฐะฑะพัั ั API ัะตัะตะท Dio.

**ะััะธัะตะบัััะฝัะต ัะตัะตะฝะธั**:

1. **Dio Interceptors** - ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะฐััะตะฝัะธัะธะบะฐัะธั:

```dart
_dio.interceptors.add(InterceptorsWrapper(
  onRequest: (options, handler) async {
    final token = await TokenStorageService.getToken();
    if (token != null) {
      options.headers['Authorization'] = 'Bearer $token';
    }
    handler.next(options);
  },
  onError: (error, handler) async {
    if (error.response?.statusCode == 401) {
      await _refreshToken(); // ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ัะพะบะตะฝะฐ
      // ะะพะฒัะพั ะทะฐะฟัะพัะฐ
    }
  },
));
```

**ะะพัะตะผั ัะฐะบ**: Interceptor ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะพะฑะฐะฒะปัะตั ัะพะบะตะฝ ะบะพ ะฒัะตะผ ะทะฐะฟัะพัะฐะผ ะธ ะพะฑัะฐะฑะฐััะฒะฐะตั 401 ะพัะธะฑะบะธ ะฑะตะท ะดัะฑะปะธัะพะฒะฐะฝะธั ะบะพะดะฐ.

2. **ะะฒััััะฐะฟะฝะฐั ะฐััะตะฝัะธัะธะบะฐัะธั**:

   - POST `/auth` ั ะธััะพะดะฝัะผ ัะพะบะตะฝะพะผ โ ะฟะพะปััะฐะตะผ ะฝะพะฒัะน ัะพะบะตะฝ
   - ะัะฟะพะปัะทัะตะผ ะฝะพะฒัะน ัะพะบะตะฝ ะบะฐะบ Bearer token ะดะปั ะฒัะตั ะทะฐะฟัะพัะพะฒ

3. **ะะตัะพะด `calculateLSI()`**:

   - ะัะฟัะฐะฒะปัะตั GET ะทะฐะฟัะพั ั query ะฟะฐัะฐะผะตััะฐะผะธ
   - ะะฑัะฐะฑะฐััะฒะฐะตั ะพัะธะฑะบะธ DioException vs ะพะฑััะฝัะต Exception
   - ะะพะทะฒัะฐัะฐะตั ัะธะฟะธะทะธัะพะฒะฐะฝะฝัะน `LSIResult`

4. **ะะตัะพะด `getColors()`**:
   - ะฃัะปะพะฒะฝะพะต ะดะพะฑะฐะฒะปะตะฝะธะต query ะฟะฐัะฐะผะตััะพะฒ (ัะพะปัะบะพ ะตัะปะธ ะฝะต null)
   - ะะพะทะฒัะฐัะฐะตั ัะฒะตัะฐ ะดะปั ะฒะธะทัะฐะปัะฝะพะน ะธะฝะดะธะบะฐัะธะธ

---

### 4. **ViewModels** (`lsi_calculator_viewmodel.dart`)

#### ะะฒะฐ StateNotifier'ะฐ:

**1. `LSIFormNotifier`** - ัะฟัะฐะฒะปะตะฝะธะต ัะพัะผะพะน:

```dart
class LSIFormState {
  final LSIParameters parameters;      // ะขะตะบััะธะต ะทะฝะฐัะตะฝะธั ะฟะพะปะตะน
  final Map<String, String?> fieldErrors; // ะัะธะฑะบะธ ะฒะฐะปะธะดะฐัะธะธ
  final bool isValid;                  // ะะพะถะฝะพ ะปะธ ะพัะฟัะฐะฒะธัั ัะพัะผั
}
```

**ะะพะณะธะบะฐ ะฒะฐะปะธะดะฐัะธะธ**:

- `pH` ะดะพะปะถะตะฝ ะฑััั ะผะตะถะดั 6.0 ะธ 9.0
- ะขะตะผะฟะตัะฐัััะฐ ะผะตะถะดั 32ยฐF ะธ 120ยฐF
- ะัะต ะฟะฐัะฐะผะตััั ะฝะต ะผะพะณัั ะฑััั ะพััะธัะฐัะตะปัะฝัะผะธ
- ะะฐะปะธะดะฐัะธั ะฟัะพะธััะพะดะธั ะฟัะธ ะบะฐะถะดะพะผ ะธะทะผะตะฝะตะฝะธะธ ะฟะพะปั

**2. `LSIResultNotifier`** - ัะฟัะฐะฒะปะตะฝะธะต ัะตะทัะปััะฐัะฐะผะธ:

```dart
class LSIResultState {
  final LSIResult? result;
  final ColorsResponse? colors;
  final bool isLoading;
  final String? error;
}
```

**ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะฟัะธ ัะฐััะตัะต**:

1. ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ `isLoading = true`
2. ะัะทัะฒะฐะตะผ `LSIApiService.calculateLSI()` (ัะฐะนะผะฐัั 15 ัะตะบ)
3. ะัะปะธ ััะฟะตัะฝะพ โ ะฒัะทัะฒะฐะตะผ `LSIApiService.getColors()` (ัะฐะนะผะฐัั 10 ัะตะบ)
4. ะัะปะธ ัะฒะตัะฐ ะฝะต ะทะฐะณััะทะธะปะธัั โ ะฟัะพะดะพะปะถะฐะตะผ ะฑะตะท ัะฒะตัะพะฒ (ะฝะต ะบัะธัะธัะฝะพ)
5. ะกะพััะฐะฝัะตะผ ัะตะทัะปััะฐั ะธะปะธ ะพัะธะฑะบั ะฒ state

**ะะฐะถะฝะพ**: ะัะฟะพะปัะทะพะฒะฐะฝะธะต `.timeout()` ะฟัะตะดะพัะฒัะฐัะฐะตั ะทะฐะฒะธัะฐะฝะธะต UI.

---

### 5. **Views** (`lsi_calculator_screen.dart`)

**ะััะธัะตะบัััะฐ**:

- `ConsumerWidget` - ะฟะพะดะฟะธััะฒะฐะตััั ะฝะฐ Riverpod providers
- ะะต ััะฐะฝะธั ัะพััะพัะฝะธะต ะปะพะบะฐะปัะฝะพ, ะฒัะต ัะตัะตะท `ref.watch()`

**ะกัััะบัััะฐ ัะบัะฐะฝะฐ**:

1. **ะกะตะบัะธั "ะขะตะบััะธะต ะฟะฐัะฐะผะตััั"** - 7 ะฟะพะปะตะน ะฒะฒะพะดะฐ
2. **ะกะตะบัะธั "ะะตะปะฐะตะผัะต ะฟะฐัะฐะผะตััั"** - 7 ะฟะพะปะตะน ะฒะฒะพะดะฐ
3. **ะะฝะพะฟะบะฐ "ะะฐัััะธัะฐัั LSI"** - ะฐะบัะธะฒะฝะฐ ัะพะปัะบะพ ะตัะปะธ `formState.isValid`
4. **ะะฝะดะธะบะฐัะพั ะทะฐะณััะทะบะธ** - ะฟะพะบะฐะทัะฒะฐะตััั ะฒะพ ะฒัะตะผั ะทะฐะฟัะพัะฐ
5. **ะะฐััะพัะบะฐ ัะตะทัะปััะฐัะพะฒ** - ะพัะพะฑัะฐะถะฐะตั LSI ะทะฝะฐัะตะฝะธั ั ัะฒะตัะฐะผะธ
6. **ะกะพะพะฑัะตะฝะธะต ะพะฑ ะพัะธะฑะบะต** - ะบัะฐัะฝะฐั ะบะฐััะพัะบะฐ ะฟัะธ ะพัะธะฑะบะฐั

**ะะตะฐะบัะธะฒะฝะพััั**:

```dart
final formState = ref.watch(lsiFormProvider);   // ะะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตัััะฐะธะฒะฐะตััั ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ัะพัะผั
final resultState = ref.watch(lsiResultProvider); // ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปัะตััั ะฟัะธ ะฟะพะปััะตะฝะธะธ ัะตะทัะปััะฐัะพะฒ
```

---

### 6. **Widgets** (ะะตัะตะธัะฟะพะปัะทัะตะผัะต ะบะพะผะฟะพะฝะตะฝัั)

#### `InputField`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะฃะฝะธะฒะตััะฐะปัะฝะพะต ะฟะพะปะต ะดะปั ัะธัะปะพะฒะพะณะพ ะฒะฒะพะดะฐ.

**ะะฐัะฐะผะตััั**:

- `label` - ะฟะพะดะฟะธัั ะฟะพะปั
- `value` - ัะตะบััะตะต ะทะฝะฐัะตะฝะธะต (controlled component)
- `onChanged` - ะบะพะปะปะฑัะบ ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ
- `errorText` - ัะตะบัั ะพัะธะฑะบะธ ะฒะฐะปะธะดะฐัะธะธ
- `suffix` - ะตะดะธะฝะธัั ะธะทะผะตัะตะฝะธั (ะฝะฐะฟัะธะผะตั, "ยฐF", "ppm")
- `min`/`max` - ะพะณัะฐะฝะธัะตะฝะธั ะดะปั ะฒะฐะปะธะดะฐัะธะธ

**ะะพัะตะผั ะพัะดะตะปัะฝัะน ะฒะธะดะถะตั**: DRY - ะฒัะต 14 ะฟะพะปะตะน ะธัะฟะพะปัะทััั ะพะดะธะฝ ะบะพะผะฟะพะฝะตะฝั.

#### `LSIResultCard`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะัะฐัะธะฒะพะต ะพัะพะฑัะฐะถะตะฝะธะต ัะตะทัะปััะฐัะพะฒ ั ัะฒะตัะพะฒะพะน ะธะฝะดะธะบะฐัะธะตะน.

**ะัะพะฑะตะฝะฝะพััะธ**:

- ะะพะฝะฒะตััะธััะตั HEX ัััะพะบะธ ะฒ `Color` ะพะฑัะตะบัั
- ะัะฟะพะปัะทัะตั ัะฒะตัะฐ ะดะปั ัะพะฝะฐ ะธ ัะตะบััะฐ ะทะฝะฐัะตะฝะธะน
- Graceful degradation: ะตัะปะธ ัะฒะตัะฐ ะฝะต ะทะฐะณััะทะธะปะธัั, ะฟะพะบะฐะทัะฒะฐะตั ะฑะตะท ะฝะธั

---

## ๐ ะะพัะพะบ ะดะฐะฝะฝัั (Data Flow)

```
1. ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั ะทะฝะฐัะตะฝะธะต ะฒ InputField
   โ
   โผ
2. InputField ะฒัะทัะฒะฐะตั onChanged(double value)
   โ
   โผ
3. LSICalculatorScreen ะฒัะทัะฒะฐะตั ref.read(lsiFormProvider.notifier).updateParameter()
   โ
   โผ
4. LSIFormNotifier ะพะฑะฝะพะฒะปัะตั LSIParameters ะธ ะฒะฐะปะธะดะธััะตั
   โ
   โผ
5. LSIFormState ะพะฑะฝะพะฒะปัะตััั โ UI ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตัััะฐะธะฒะฐะตััั (ref.watch)
   โ
   โผ
6. ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั "ะะฐัััะธัะฐัั LSI"
   โ
   โผ
7. LSICalculatorScreen ะฒัะทัะฒะฐะตั ref.read(lsiResultProvider.notifier).calculateLSI()
   โ
   โผ
8. LSIResultNotifier ะฒัะทัะฒะฐะตั LSIApiService.calculateLSI()
   โ
   โผ
9. LSIApiService ะดะตะปะฐะตั ะทะฐะฟัะพั ะบ API (ั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะฐััะตะฝัะธัะธะบะฐัะธะตะน ัะตัะตะท interceptor)
   โ
   โผ
10. ะะพะปััะตะฝะฝัะน LSIResult ัะพััะฐะฝัะตััั ะฒ LSIResultState
    โ
    โผ
11. UI ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปัะตััั ะธ ะฟะพะบะฐะทัะฒะฐะตั ัะตะทัะปััะฐัั
```

---

## ๐๏ธ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

| ะะพะผะฟะพะฝะตะฝั              | ะขะตัะฝะพะปะพะณะธั                          | ะะฐัะตะผ                               |
| ---------------------- | ----------------------------------- | ----------------------------------- |
| **State Management**   | Riverpod 2.5.1                      | ะฃะฟัะฐะฒะปะตะฝะธะต ัะพััะพัะฝะธะตะผ, ัะตะฐะบัะธะฒะฝะพััั |
| **HTTP Client**        | Dio 5.4.0                           | HTTP ะทะฐะฟัะพัั ั interceptors         |
| **Secure Storage**     | flutter_secure_storage 9.2.2        | ะะตะทะพะฟะฐัะฝะพะต ััะฐะฝะตะฝะธะต ัะพะบะตะฝะพะฒ         |
| **JSON Serialization** | json_annotation + json_serializable | ะะฒัะพะผะฐัะธัะตัะบะฐั ัะตัะธะฐะปะธะทะฐัะธั ะผะพะดะตะปะตะน |
| **Form Validation**    | form_validator 2.1.1                | ะะฐะปะธะดะฐัะธั ะฟะพะปะตะน ัะพัะผั               |
| **UI Framework**       | Flutter (Material 3)                | ะกะพะฒัะตะผะตะฝะฝัะน Material Design         |

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั

1. **ะขะพะบะตะฝั ััะฐะฝัััั ะฒ Secure Storage** - ะทะฐัะธััะพะฒะฐะฝั ะฝะฐ ััะพะฒะฝะต ะะก
2. **ะะฒัะพะผะฐัะธัะตัะบะธะน refresh ัะพะบะตะฝะฐ** ะฟัะธ 401 ะพัะธะฑะบะต
3. **ะขะฐะนะผะฐััั ะฝะฐ ะทะฐะฟัะพัั** - ะฟัะตะดะพัะฒัะฐัะฐัั ะทะฐะฒะธัะฐะฝะธะต
4. **ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ** - ะฟะพะปัะทะพะฒะฐัะตะปั ะฒัะตะณะดะฐ ะฒะธะดะธั ะฟะพะฝััะฝะพะต ัะพะพะฑัะตะฝะธะต

---

## ๐ฏ ะะปััะตะฒัะต ะฐััะธัะตะบัััะฝัะต ัะตัะตะฝะธั

### ะะพัะตะผั MVVM?

- **ะะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ**: UI ะพัะดะตะปะตะฝ ะพั ะฑะธะทะฝะตั-ะปะพะณะธะบะธ
- **ะขะตััะธััะตะผะพััั**: ViewModel ะผะพะถะฝะพ ัะตััะธัะพะฒะฐัั ะฑะตะท UI
- **ะะตัะตะธัะฟะพะปัะทัะตะผะพััั**: ViewModels ะผะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั ะฒ ัะฐะทะฝัั Views

### ะะพัะตะผั Riverpod ะฒะผะตััะพ Provider/Bloc?

- ะะพะปะตะต ัะพะฒัะตะผะตะฝะฝัะน ะธ ัะธะฟะพะฑะตะทะพะฟะฐัะฝัะน
- ะะฒัะพะผะฐัะธัะตัะบะพะต ัะฟัะฐะฒะปะตะฝะธะต ะถะธะทะฝะตะฝะฝัะผ ัะธะบะปะพะผ
- ะัััะฐั ะฟะพะดะดะตัะถะบะฐ async ะพะฟะตัะฐัะธะน
- Compile-time ะฑะตะทะพะฟะฐัะฝะพััั (ะพัะธะฑะบะธ ะฒะธะดะฝั ะฝะฐ ััะฐะฟะต ะบะพะผะฟะธะปััะธะธ)

### ะะพัะตะผั Dio ะฒะผะตััะพ http?

- Interceptors ะดะปั ะณะปะพะฑะฐะปัะฝะพะน ะปะพะณะธะบะธ (ะฐััะตะฝัะธัะธะบะฐัะธั, ะปะพะณะธัะพะฒะฐะฝะธะต)
- ะัััะฐั ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
- ะะพะดะดะตัะถะบะฐ ะพัะผะตะฝั ะทะฐะฟัะพัะพะฒ
- ะะพะปะตะต ะณะธะฑะบะฐั ะบะพะฝัะธะณััะฐัะธั

### ะะพัะตะผั Static Services ะฒะผะตััะพ Providers?

- ะัะพััะพัะฐ: ะฝะต ะฝัะถะฝะฐ DI ะบะพะฝัะตะนะฝะตั ะดะปั ะฟัะพัััั ัะปััะฐะตะฒ
- ะะตะฝััะต boilerplate ะบะพะดะฐ
- ะะพััะฐัะพัะฝะพ ะดะปั singleton ัะตัะฒะธัะพะฒ

---

## ๐ ะะฐะถะฝัะต ะดะตัะฐะปะธ ัะตะฐะปะธะทะฐัะธะธ

### 1. ะะฑัะฐะฑะพัะบะฐ ัะธะฟะพะฒ ะดะฐะฝะฝัั ะพั API

API ะผะพะถะตั ะฒะพะทะฒัะฐัะฐัั ัะธัะปะฐ ะบะฐะบ `num` ะธะปะธ `String`. ะะตัะพะด `_parseDouble()` ะพะฑัะฐะฑะฐััะฒะฐะตั ะพะฑะฐ ัะปััะฐั:

```dart
static double _parseDouble(dynamic value) {
  if (value == null) return 0.0;
  if (value is num) return value.toDouble();
  if (value is String) return double.parse(value);
  throw Exception('Cannot parse $value as double');
}
```

### 2. Graceful degradation ะดะปั ัะฒะตัะพะฒ

ะัะปะธ ะทะฐะฟัะพั ัะฒะตัะพะฒ ะฝะต ัะดะฐะปัั, ะฟัะธะปะพะถะตะฝะธะต ะฟัะพะดะพะปะถะฐะตั ัะฐะฑะพัะฐัั ะฑะตะท ัะฒะตัะพะฒ - ััะพ ะฝะต ะบัะธัะธัะฝะฐั ััะฝะบัะธั.

### 3. ะะฐะปะธะดะฐัะธั ะฝะฐ ััะพะฒะฝะต ViewModel

ะะฐะปะธะดะฐัะธั ะฟัะพะธััะพะดะธั ะฝะต ะฒ UI, ะฐ ะฒ ViewModel - ััะพ ะฟัะฐะฒะธะปัะฝัะน ะฟะพะดัะพะด ะดะปั MVVM.

### 4. Immutable State

ะัะต state ะบะปะฐััั ะธัะฟะพะปัะทััั `copyWith()` ะดะปั ะพะฑะฝะพะฒะปะตะฝะธะน - ััะพ ะฟัะตะดะพัะฒัะฐัะฐะตั ัะปััะฐะนะฝัะต ะผััะฐัะธะธ.

---

## ๐ ะขะพัะบะฐ ะฒัะพะดะฐ (`main.dart`)

```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized(); // ะะฐะถะฝะพ ะดะปั async ะพะฟะตัะฐัะธะน

  await TokenStorageService.initializeDefaultToken(); // ะกะพััะฐะฝัะตะผ ัะพะบะตะฝ ะฟัะธ ััะฐััะต
  LSIApiService.initialize(); // ะะฝะธัะธะฐะปะธะทะธััะตะผ Dio ั interceptors

  runApp(const ProviderScope(child: MyApp())); // ProviderScope ะฝะตะพะฑัะพะดะธะผ ะดะปั Riverpod
}
```

**ะะพัะตะผั async ะฒ main**: ะะฝะธัะธะฐะปะธะทะฐัะธั ะดะพะปะถะฝะฐ ะทะฐะฒะตััะธัััั ะดะพ ะทะฐะฟััะบะฐ ะฟัะธะปะพะถะตะฝะธั.

---

## ๐ ะะปั ะดะฐะปัะฝะตะนัะตะณะพ ะธะทััะตะฝะธั

1. **Riverpod ะดะพะบัะผะตะฝัะฐัะธั**: https://riverpod.dev
2. **Dio ะดะพะบัะผะตะฝัะฐัะธั**: https://pub.dev/packages/dio
3. **MVVM ะฒ Flutter**: https://docs.flutter.dev/development/data-and-backend/state-mgmt/options
4. **Flutter Secure Storage**: https://pub.dev/packages/flutter_secure_storage

---

## โ ะงะฐัััะต ะฒะพะฟัะพัั ะพั ะผะธะดะปะพะฒ

**Q: ะะพัะตะผั ะดะฒะฐ ะพัะดะตะปัะฝัั StateNotifier ะดะปั ัะพัะผั ะธ ัะตะทัะปััะฐัะพะฒ?**
A: Single Responsibility Principle - ัะพัะผะฐ ะธ ัะตะทัะปััะฐัั ะธะผะตัั ัะฐะทะฝัะต ะถะธะทะฝะตะฝะฝัะต ัะธะบะปั ะธ ะพัะฒะตัััะฒะตะฝะฝะพััะธ.

**Q: ะะฐัะตะผ ะฝัะถะตะฝ `copyWith()` ะตัะปะธ ะผะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั ะพะฑััะฝัะต ัะตััะตัั?**
A: Immutability ะฟัะตะดะพัะฒัะฐัะฐะตั ะฑะฐะณะธ ั ะผััะฐัะธัะผะธ. ะขะฐะบะถะต ััะพ ัะฟัะพัะฐะตั ะพัะปะฐะดะบั - ะปะตะณัะต ะพััะปะตะดะธัั, ะณะดะต ัะพััะพัะฝะธะต ะธะทะผะตะฝะธะปะพัั.

**Q: ะะพัะตะผั Interceptors, ะฐ ะฝะต ัััะฝะฐั ะดะพะฑะฐะฒะบะฐ ัะพะบะตะฝะฐ ะฒ ะบะฐะถะดะพะผ ะทะฐะฟัะพัะต?**
A: DRY - ัะพะบะตะฝ ะดะพะฑะฐะฒะปัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ, ะฝะต ะฝัะถะฝะพ ะฟะพะผะฝะธัั ะพะฑ ััะพะผ ะฒ ะบะฐะถะดะพะผ ะผะตัะพะดะต. ะขะฐะบะถะต ะปะตะณะบะพ ะดะพะฑะฐะฒะธัั ะปะพะณะธัะพะฒะฐะฝะธะต, retry ะปะพะณะธะบั ะธ ั.ะด.

**Q: ะะพัะตะผั ะฒะฐะปะธะดะฐัะธั ะฒ ViewModel, ะฐ ะฝะต ะฒ UI?**
A: ะะพะณะธะบะฐ ะฒะฐะปะธะดะฐัะธะธ - ััะพ ะฑะธะทะฝะตั-ะปะพะณะธะบะฐ, ะพะฝะฐ ะฝะต ะดะพะปะถะฝะฐ ะฑััั ะฒ UI. ะะปัั ะผะพะถะฝะพ ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐัั ะฒ ะดััะณะธั ะผะตััะฐั.

---

## ๐ ะะฐะบะปััะตะฝะธะต

ะัะพะตะบั ะดะตะผะพะฝัััะธััะตั:

- โ ะัะฐะฒะธะปัะฝะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต MVVM ะฐััะธัะตะบัััั
- โ ะกะพะฒัะตะผะตะฝะฝัะต ะฟัะฐะบัะธะบะธ Flutter ัะฐะทัะฐะฑะพัะบะธ
- โ ะะตะทะพะฟะฐัะฝะพะต ััะฐะฝะตะฝะธะต ััะฒััะฒะธัะตะปัะฝัั ะดะฐะฝะฝัั
- โ ะะฑัะฐะฑะพัะบั ะพัะธะฑะพะบ ะธ edge cases
- โ ะขะธะฟะพะฑะตะทะพะฟะฐัะฝะพััั ะธ null-safety
- โ ะงะธัััะน ะธ ะฟะพะดะดะตัะถะธะฒะฐะตะผัะน ะบะพะด

ะญัะพ production-ready ะฐััะธัะตะบัััะฐ, ะบะพัะพััั ะผะพะถะฝะพ ะผะฐัััะฐะฑะธัะพะฒะฐัั ะธ ัะฐััะธัััั.
